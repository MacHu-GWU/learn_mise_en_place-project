[env]
PY_PROJECT_NAME = 'learn_mise_en_place'

[tools]
aws = { version = "latest", symlink_bins = "true" }
claude = { version = "latest", bin = "claude", platforms = """
[linux-arm64]
url = "https://storage.googleapis.com/claude-code-dist-86c565f3-f756-42ad-8dfa-d59b1c096819/claude-code-releases/{version}/linux-arm64/claude"

[linux-x64]
url = "https://storage.googleapis.com/claude-code-dist-86c565f3-f756-42ad-8dfa-d59b1c096819/claude-code-releases/{version}/linux-x64/claude"

[macos-arm64]
url = "https://storage.googleapis.com/claude-code-dist-86c565f3-f756-42ad-8dfa-d59b1c096819/claude-code-releases/{version}/darwin-arm64/claude"

[macos-x64]
url = "https://storage.googleapis.com/claude-code-dist-86c565f3-f756-42ad-8dfa-d59b1c096819/claude-code-releases/{version}/darwin-x64/claude"
""", version_list_url = "https://storage.googleapis.com/claude-code-dist-86c565f3-f756-42ad-8dfa-d59b1c096819/claude-code-releases/stable" }
# --- Node
node = "22"
pnpm = "latest"
# --- Python
python = "3.12"
ruff = "latest"
uv = "latest"

[tasks.venv-create]
description = "‚≠ê Create project virtual environment (.venv)"
run = "uv venv"

[tasks.venv-remove]
description = "üí• Remove project virtual environment completely"
run = "rm -r .venv"

[tasks.inst]
description = "‚≠ê Install main runtime dependencies and all extra dependencies (dev, test, doc, ...)"
run = "uv sync --all-extras"

[tasks.export]
description = "‚≠ê Export locked dependencies to requirements.txt for deployment"
run = """
uv export --no-dev --no-hashes > requirements.txt
uv export --no-dev --all-extras --no-hashes > requirements-all.txt
"""

[tasks.fmt]
description = "Format code"
run = "ruff format $PY_PROJECT_NAME/"

[tasks.test]
description = "‚≠ê Run unit tests"
run = """
.venv/bin/pytest \
    -s \
    --rootdir=. \
    tests
"""

[tasks.cov]
description = "‚≠ê Run tests with coverage analysis"
run = """
.venv/bin/pytest \
    -s \
    --tb=native \
    --rootdir=. \
    --cov=$PY_PROJECT_NAME \
    --cov-report term-missing \
    --cov-report html:htmlcov \
    tests
"""

[tasks.view-cov]
description = "‚≠ê Open coverage report in browser (run after cov)"
run = """
open htmlcov/index.html
"""

[tasks.build-doc]
description = "‚≠ê Build Sphinx documentation (output: docs/build/html)"
run = """
.venv/bin/sphinx-build \
    -M \
    html \
    docs/source \
    docs/build
"""

[tasks.view-doc]
description = "‚≠ê Open built documentation in browser"
run = """
open docs/build/html/index.html
"""

[tasks.build]
description = "üèó Build Python wheel and source distribution packages"
run = """
uv build
"""

[tasks.publish]
description = "‚≠ê Build and publish package to AWS CodeArtifact"
run = """
.venv/bin/twine \
    upload \
    dist/*
"""
depends = ['build']
